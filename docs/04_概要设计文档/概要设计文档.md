# Custom Logger 概要设计文档

## 1. 系统概述

Custom Logger是一个高性能Python日志系统，支持多进程、异步写入和灵活配置。

## 2. 核心模块

### 2.1 manager.py - 系统管理
- **职责**：初始化、资源管理、API入口
- **核心函数**：
  - `init_custom_logger_system()` - 主程序初始化
  - `init_custom_logger_system_for_worker()` - Worker进程初始化
  - `get_logger()` - 获取日志器实例
  - 占位函数4个（未实现，抛出NotImplementedError）

### 2.2 logger.py - 日志记录
- **职责**：日志生成、级别控制、格式化调用
- **特性**：支持标准和扩展级别、倒计时功能

### 2.3 config.py - 配置管理
- **职责**：配置加载、路径生成、级别解析
- **约束**：不使用config_manager，只用其创建的对象

### 2.4 writer.py - 异步写入
- **职责**：文件写入、队列管理、批量处理
- **特性**：后台线程、异步IO、自动flush

### 2.5 formatter.py - 格式化
- **职责**：日志格式化、颜色支持、调用者识别
- **输出格式**：`[PID | 模块名:行号] 时间 - 耗时 - 级别 - 消息`

### 2.6 types.py - 类型定义
- **职责**：级别常量、名称映射、类型转换

## 3. 数据流

```
用户调用 → manager.get_logger() → logger记录 
         → formatter格式化 → writer异步写入 → 文件系统
```

## 4. 关键设计决策

1. **配置隔离**：每个进程独立配置，避免冲突
2. **异步写入**：提高性能，减少阻塞
3. **占位函数**：保留API扩展点，明确未实现功能
4. **队列模式**：支持多进程环境下的日志收集
5. **名称限制**：Logger名称最大16字符，保证格式对齐

## 5. 性能考虑

- 批量写入减少IO操作
- 队列缓冲防止阻塞
- 条件编译减少无效操作
- 智能flush策略平衡性能与实时性

## 6. 扩展点

- 占位函数为未来功能预留接口
- 配置系统支持动态扩展
- 格式化器支持自定义模板
- 写入器支持多种后端